<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AP√âRO DE NUIT 66¬Æ</title>
  <meta name="theme-color" content="#000000"/>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link href="https://fonts.googleapis.com/css2?family=Baloo&display=swap" rel="stylesheet"/>

  <style>
    html, body {
      margin:0; padding:0;
      width:100%; height:100%;
      overflow:hidden;
      font-family:'Baloo', cursive;
      background:#000;
    }

    /* FIX MOBILE ‚Üí HAUTEUR R√âELLE */
    #game-container {
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      height:100dvh;
      overflow:hidden;
    }

    #gameCanvas, .bg-layer { pointer-events:none; }

    .bg-layer {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      background-repeat:repeat-x;
      background-size:auto 100%;
      transition:opacity 1s ease;
      opacity:0;
      z-index:0;
    }

    #bgLayer1, #bgLayer2 { background-position:0 0; }

    #gameCanvas {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      z-index:1;
      background:transparent;
    }

    #cloud {
      position:absolute;
      opacity:0.5;
      z-index:5;
      pointer-events:none;
    }

    /* HUD */
    #score, #livesDisplay {
      position:absolute;
      z-index:10;
      pointer-events:none;
    }

    #score {
      top:2vh; left:2vw;
      color:#fff;
      font-size:3vh;
      background:rgba(0,0,0,0.5);
      padding:0.5vh 1vw;
      border-radius:1vh;
    }

    #livesDisplay { top:2vh; right:2vw; }

    .heart {
      width:4vh; height:4vh;
      background-image:url('https://i.postimg.cc/QCzhYMMB/file-00000000c25061f7b431b34a26caa8d5-1.png');
      background-size:cover;
      display:inline-block;
      margin-left:1vw;
    }

    /* Bouton son */
    #soundToggle {
      position:absolute;
      top:8vh;
      right:2vw;
      z-index:11;
      background:rgba(0,0,0,0.5);
      color:#fff;
      border:none;
      padding:0.5vh 1vw;
      border-radius:1vh;
      font-size:2.2vh;
      cursor:pointer;
      pointer-events:auto;
    }

    /* Overlays */
    .overlay {
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%, -50%);
      background:rgba(0,0,0,0.7);
      padding:2.7vh 2.7vw;
      border-radius:2vh;
      color:#fff;
      text-align:center;
      z-index:20;
      width:78vw;
      max-width:380px;
      pointer-events:auto;
    }

    .overlay h1, .overlay h2 {
      margin:0 0 1.8vh;
      font-size:3.6vh;
    }

    .overlay p {
      font-size:2.3vh;
      margin-bottom:1.3vh;
    }

    .overlay button {
      display:block;
      width:100%;
      padding:1.4vh 0;
      font-size:2.8vh;
      margin:0.9vh 0;
      border:none;
      border-radius:1vh;
      cursor:pointer;
      background:#add8e6;
      transition:transform .2s;
    }

    .overlay button:hover {
      transform:scale(1.05);
    }

    #highScoresList p {
      margin:0.4vh 0;
      line-height:1.1;
      font-size:2.3vh;
    }

    #koEffect {
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(255,0,0,0.5);
      display:none;
      z-index:30;
      pointer-events:none;
    }

    #pointFlash {
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      background:#ffffff;
      opacity:0;
      pointer-events:none;
      z-index:12;
      transition:opacity 0.15s linear;
    }

    /* Barre progression */
    #brandProgress {
      position:absolute;
      bottom:3vh;
      left:50%;
      transform:translateX(-50%);
      width:80vw;
      max-width:500px;
      background:rgba(0,0,0,0.6);
      padding:1.5vh 2vw;
      border-radius:2vh;
      color:#fff;
      z-index:10;
      font-size:2vh;
      pointer-events:none;
    }

    #brandStageTitle { font-size:2.2vh; margin-bottom:0.5vh; }
    #brandStageMessage { font-size:1.8vh; opacity:0.9; margin-bottom:1vh; }

    #brandStageBar {
      width:100%;
      height:1.2vh;
      background:rgba(255,255,255,0.15);
      border-radius:1vh;
      overflow:visible;
      position:relative;
    }

    #brandStageFill {
      width:0%;
      height:100%;
      background:linear-gradient(90deg, #fdd835, #ff9800);
      transition:width 0.2s ease-out;
    }

    .gift-marker {
      position:absolute;
      transform:translateX(-50%);
      pointer-events:none;
      text-shadow:0 0 6px rgba(0,0,0,0.9);
      z-index:5;
    }

    #gift25 { left:50%; top:-2vh; font-size:3.2vh; }
    #gift50 { left:100%; top:-3.5vh; font-size:4.2vh; }

    .gold-button {
      background:linear-gradient(135deg, #ffd700, #ffb300);
      color:#000;
      font-weight:bold;
      box-shadow:0 0 12px rgba(255,215,0,0.8);
    }
  </style>
</head>

<body>
  <div id="game-container">

    <div id="bgLayer1" class="bg-layer"></div>
    <div id="bgLayer2" class="bg-layer"></div>

    <img id="cloud" src="https://i.postimg.cc/zfTZ14kC/NUAGE.png" alt="nuage">
    <canvas id="gameCanvas" width="480" height="640"></canvas>

    <div id="score">Score : 0</div>
    <div id="livesDisplay">
      <div class="heart"></div>
      <div class="heart"></div>
      <div class="heart"></div>
    </div>
    <!-- Barre progression -->
    <div id="brandProgress">
      <div id="brandStageTitle">Commande en attente üí§</div>
      <div id="brandStageMessage">Attrape des bouteilles pour lancer la nuit.</div>
      <div id="brandStageBar">
        <div id="brandStageFill"></div>
        <div id="gift25" class="gift-marker">üéÅ</div>
        <div id="gift50" class="gift-marker">üéÅ</div>
      </div>
    </div>

    <!-- Menu principal -->
    <div id="menu" class="overlay">
      <h1>AP√âRO DE NUIT 66¬Æ</h1>
      <button id="playBtn">Jouer</button>
      <button id="instructionsBtn">Instructions</button>
      <button id="useCodeBtn">Utiliser mon code</button>

      <div id="highScores">
        <h2>Meilleurs scores</h2>
        <div id="highScoresList"><p>Aucun score.</p></div>
      </div>

      <div id="promoCodes">
        <h2>üéÅ Surprise</h2>
        <div id="promoCodesList"><p>Pas disponible.</p></div>
      </div>
    </div>

    <!-- Instructions -->
    <div id="instructionsOverlay" class="overlay" style="display:none;">
      <h2>Instructions</h2>
      <p>ü¶â Attrape des bouteilles et √©vite les avions.</p>
      <p>‚ù§Ô∏è Tu as 3 vies.</p>
      <p>üéÅ Premier cadeau √† <strong>25 points</strong>.</p>
      <button id="closeInstructionsBtn">Fermer</button>
    </div>

    <!-- Perte de vie -->
    <div id="continueScreen" class="overlay" style="display:none;">
      <h2>Perdu une vie !</h2>
      <button id="continueBtn">Continuer</button>
    </div>

    <!-- Game Over -->
    <div id="gameOver" class="overlay" style="display:none;">
      <h2>Game Over</h2>
      <p id="finalScore"></p>
      <p id="gameOverMsg"></p>

      <p id="reviewText" style="display:none; margin-top:1vh; font-size:2vh;">
        Tu as kiff√© le jeu ? üíú  
        Laisse un avis Google pour soutenir Ap√©ro de Nuit 66¬Æ üôè
      </p>

      <button id="reviewBtn" class="gold-button" style="display:none;">
        ‚≠ê Laisser un avis Google
      </button>

      <button id="restartBtn">Rejouer</button>
      <button id="menuBtn">Menu</button>
    </div>

    <div id="koEffect"></div>
    <div id="pointFlash"></div>

    <!-- Sons -->
    <audio id="jumpSound" src="https://assets.mixkit.co/active_storage/sfx/255/255-preview.mp3"></audio>
    <audio id="explosionSound" src="https://assets.mixkit.co/active_storage/sfx/235/235-preview.mp3"></audio>
    <audio id="gameOverSound" src="https://assets.mixkit.co/active_storage/sfx/458/458-preview.mp3"></audio>
    <audio id="pointSound" src="https://assets.mixkit.co/active_storage/sfx/166/166-preview.mp3"></audio>
    <audio id="lifeLostSound" src="https://assets.mixkit.co/active_storage/sfx/1781/1781-preview.mp3"></audio>
    <audio id="rewardSound" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
    <audio id="clickSound" src="https://assets.mixkit.co/active_storage/sfx/2574/2574-preview.mp3"></audio>
    <audio id="bgMusic" src="https://assets.mixkit.co/music/preview/mixkit-8-bit-game-770.mp3" loop></audio>

  </div> <!-- FIN game-container -->

  <!-- ====================== -->
  <!--   JAVASCRIPT DU JEU    -->
  <!-- ====================== -->

  <script>
  document.addEventListener('DOMContentLoaded', () => {

    const container = document.getElementById('game-container');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('score');
    const livesEls = document.querySelect

    <button id="soundToggle">üîä</button>
